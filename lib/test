

export async function generateAdultTicketPDF(booking: any, ticket: any, index: any): Promise<Buffer> {
  const localizedTitle = ticket.title[booking.locale] || ticket.title["en"];

  return new Promise(async (resolve, reject) => {
    try {
      const fontPath = path.join(process.cwd(), "public", "fonts", "Roboto-Regular.ttf");
      if (!fs.existsSync(fontPath)) return reject(new Error("Font file missing: " + fontPath));

      const doc = new PDFDocument({ margin: 50 });
      const chunks: Buffer[] = [];
      doc.on("data", (chunk) => chunks.push(chunk));
      doc.on("end", () => resolve(Buffer.concat(chunks)));
      doc.on("error", reject);

      // âœ… Generate QR code
      const qrDataUrl = await QRCode.toDataURL(booking.bookingId);
      const qrBuffer = Buffer.from(qrDataUrl.split(",")[1], "base64");

      // ðŸŸ¦ Header Banner
      doc.rect(0, 0, doc.page.width, 100).fill("#0077B6");
      doc.fillColor("white").fontSize(26).text("BUS & BOAT PARIS", 50, 35);
      doc.fontSize(14).text("Adult E-Ticket Confirmation", 50, 65);
      doc.fillColor("black");

      // ðŸ”’ Watermark Background
      doc.save();
      doc.rotate(-45, { origin: [300, 400] });
      doc.fontSize(80).fillColor("rgba(0,0,0,0.05)").text("BUS & BOAT PARIS", 0, 300, {
        align: "center",
        width: doc.page.width * 2,
      });
      doc.restore();

      // ðŸ§¾ Booking Details
      doc.moveDown(3);
      doc.fontSize(18).fillColor("#0077B6").text("Booking Details", 50);
      doc.moveDown(0.5);
      doc.fontSize(12).fillColor("#333");
      doc.text(`Booking ID: ${booking.bookingId}`);
      doc.text(`Customer Name: ${booking.customerName}`);
      doc.text(`Email: ${booking.customerEmail}`);
      doc.text(`Phone: ${booking.customerPhone}`);

      // ðŸŽŸ Trip Info
      doc.moveDown(1.5);
      doc.fontSize(18).fillColor("#0077B6").text("Trip Information");
      doc.moveDown(0.5);
      doc.fontSize(12).fillColor("#333");
      doc.text(`Package: ${localizedTitle}`);
      doc.text(`Travel Date: ${new Date(booking.travelDate).toLocaleDateString()}`);
      doc.text(`Passenger Type: Adult`);
      doc.text(`Total Amount: $${booking.totalAmount}`);

      // ðŸ§¾ QR Code
      doc.image(qrBuffer, 400, 180, { width: 130, height: 130 });
      doc.fontSize(10).fillColor("#555").text("Scan this QR to verify booking", 400, 320);

      // ðŸª¶ Footer
      doc.moveDown(5);
      doc.fontSize(10).fillColor("#777").text("Please present this e-ticket before boarding.", 50);
      doc.text("Thank you for choosing Bus & Boat Paris!", 50);

      doc.end();
    } catch (err) {
      reject(err);
    }
  });
}
